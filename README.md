# GirdBot_BN - 网格交易机器人 v2.1.0

一个功能完善的币安期货网格交易机器人，支持双向持仓、智能止盈、风险控制等功能。

## 🆕 v2.1.0 新功能

### ✨ 启动清理功能
- 策略启动前自动撤销所有挂单
- 策略启动前自动平仓所有持仓
- 确保账户状态干净后再开始交易

### ✨ 优雅停止功能
- 支持 Ctrl+C 安全停止
- 停止时自动撤销所有挂单
- 停止时自动平仓所有持仓
- 完整的清理验证机制

### ✨ 增强的安全性
- 完善的异常处理机制
- 详细的日志记录
- 多重安全检查
- 缓存变量初始化修复

## 📁 文件结构

```
GirdBot_BN/
├── main.py                          # 主程序入口
├── start_grid_bot.py               # 启动脚本 (推荐使用)
├── exchange_client.py              # 交易所客户端
├── grid_strategy.py                # 网格策略核心
├── websocket_handler.py            # WebSocket处理器
├── config.py                       # 配置文件 (需要创建)
├── config_template.py              # 配置模板
├── test_cleanup.py                 # 清理功能测试脚本
├── 网格交易策略功能说明文档.md      # 详细功能说明
├── 启动清理和优雅停止功能说明.md    # 新功能说明
├── 项目需修复问题的建议—2.md       # 修复建议 (已完成)
└── log/                            # 日志目录
    └── *.log                       # 日志文件
```

## 🎯 主要功能

### 双向网格策略
- 同时支持多头和空头操作
- 动态网格价格调整
- 智能仓位管理

### 风险控制
- 仓位阈值控制
- 动态止盈机制
- 双向库存风险管理
- API频率控制

### 实时数据处理
- WebSocket实时价格推送
- 订单状态实时同步
- 自动重连机制

### 精度处理
- 自动价格精度调整
- 数量精度处理
- 最小下单量检查

## 🚀 快速开始

### 1. 环境要求
- Python 3.8+
- 币安期货账户
- API密钥 (需要期货交易权限)

### 2. 安装依赖
```bash
pip install ccxt websockets asyncio
```

### 3. 配置设置
复制配置模板并填写您的信息：
```bash
cp config_template.py config.py
```

编辑 `config.py` 文件：
```python
# API 配置
API_KEY = "your_api_key_here"
API_SECRET = "your_api_secret_here"

# 交易配置
COIN_NAME = "DOGE"          # 交易币种
CONTRACT_TYPE = "USDC"      # 合约类型
GRID_SPACING = 0.001        # 网格间距 (0.1%)
INITIAL_QUANTITY = 20       # 初始交易数量
LEVERAGE = 10               # 杠杆倍数
```

### 4. 启动机器人

#### 方式一：使用启动脚本 (推荐)
```bash
python start_grid_bot.py
```

#### 方式二：直接启动
```bash
python main.py
```

### 5. 安全停止
按 `Ctrl+C` 即可安全停止程序，机器人会：
1. 停止WebSocket连接
2. 撤销所有挂单
3. 平仓所有持仓
4. 验证清理完成后退出

## 🧪 测试功能

### 测试清理功能
```bash
python test_cleanup.py
```

选择测试模式：
1. 测试完整清理功能
2. 测试单独功能 (撤单/平仓)
3. 查看当前账户状态

## ⚙️ 配置参数说明

### API配置
- `API_KEY`: 币安API密钥
- `API_SECRET`: 币安API密钥
- `WEBSOCKET_URL`: WebSocket连接地址

### 交易配置
- `COIN_NAME`: 交易币种 (如 DOGE, BTC, ETH)
- `CONTRACT_TYPE`: 合约类型 (USDT 或 USDC)
- `GRID_SPACING`: 网格间距 (0.001 = 0.1%)
- `INITIAL_QUANTITY`: 初始交易数量
- `LEVERAGE`: 杠杆倍数

### 风控配置
- `POSITION_THRESHOLD`: 锁仓阈值
- `POSITION_LIMIT`: 持仓数量阈值
- `MAX_POSITION_RATIO`: 最大仓位比例
- `STOP_LOSS_RATIO`: 止损比例

### 时间配置
- `SYNC_TIME`: 同步间隔时间 (秒)
- `ORDER_FIRST_TIME`: 首单间隔时间 (秒)

## 🔍 日志监控

### 日志文件位置
- `log/main.log`: 主程序日志
- `log/grid_bot_YYYYMMDD_HHMMSS.log`: 带时间戳的日志

### 关键日志信息
- 账户清理过程
- 订单执行状态
- 持仓变化记录
- 异常错误信息
- 网格策略调整

## ⚠️ 重要提示

### 安全建议
1. **测试环境验证**: 生产使用前请在测试网验证
2. **API权限**: 确保API密钥权限设置正确
3. **资金管理**: 合理设置仓位和杠杆
4. **监控运行**: 定期检查策略运行状态

### 风险提示
1. **市场风险**: 极端行情可能导致损失
2. **技术风险**: 网络中断、API限制等
3. **参数风险**: 不当参数可能影响收益
4. **流动性风险**: 市场流动性不足的影响

## 🛠️ 故障排除

### 常见问题
1. **API连接失败**: 检查密钥和网络
2. **订单被拒绝**: 检查精度和保证金
3. **WebSocket中断**: 检查网络稳定性
4. **清理不完整**: 手动检查剩余订单

### 调试技巧
1. 使用测试脚本验证功能
2. 查看详细日志信息
3. 检查API权限设置
4. 验证配置参数正确性

## 📞 技术支持

如有问题请查看：
1. `网格交易策略功能说明文档.md` - 详细功能说明
2. `启动清理和优雅停止功能说明.md` - 新功能说明
3. 日志文件中的错误信息
4. 使用测试脚本进行诊断

---

**免责声明**: 本软件仅供学习和研究使用，使用者需自行承担交易风险。
